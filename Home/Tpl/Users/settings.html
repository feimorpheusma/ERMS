<{include file="../Public/header.html"}>

<div id="sub-header" class="group_h">
    <div class="container">
        <div class="navbar-header col-sm-offset-1" style="width: 16.66666666%;margin: 0;">
            <h1><a href="__APP__/Users/settings">个人设置</a></h1>
        </div>
        <div class="col-md-6">
            <ul class="navbar-left">
                <li class="active"><span id="mysetting"><a href="javascript:void(0)">个人信息</a></span></li>
                <li><span id="setpass"><a href="javascript:void(0)">密码设置</a></span></li>
            </ul>
        </div>
    </div>
</div>

<script>
    $(function () {
        $("#mysetting").click(function () {
            $("#mysetting").parent().addClass("active");
            $("#setpass").parent().removeClass("active");
            $("#setpassword").hide();
            $("#setting").show();
        });
        $("#setpass").click(function () {
            $("#mysetting").parent().removeClass("active");
            $("#setpass").parent().addClass("active");
            $("#setpassword").show();
            $("#setting").hide();
        });
    });
</script>


<div id="main">
    <div class="container">
        <div class="home_module">
            <div class="container">

                <div class="col-md-7" id="setting" style="display:block;">

                    <div class="tt">
                        <h3>个人信息</h3>
                    </div>
                    <hr>
                    <form id="profile-form" name="myform" class="mt30 form-horizontal" autocomplete="off"
                          action="__APP__/Users/updateset" onsubmit="return doCheck();" method="POST">

                        <input type="hidden" name="id" value="<{$smarty.session.user.id}>">

                        <div class="form-group clearfix">
                            <div style="margin-left:-10px;"><label class="control-label col-md-2">头像</label></div>
                            <div class="col-md-6 settings_avatar">
                                <div class="clearfix mb10">
                                    <div class="pull-left">
                                        <img height='85' width='85'
                                             src="<{if $smarty.session.user.picture==''}>__PUBLIC__/uploads/student/0/1.jpg<{else}>__PUBLIC__/uploads/student/<{$smarty.session.user.no}>/<{$smarty.session.user.picture}><{/if}>"
                                             class="avatar_bg">
                                    </div>
                                </div>
                                <a href="__APP__/Users/avatar" class="btn btn-default">更新头像</a>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-2 text-right"><label>学号</label></div>
                            <div class="col-md-10"><{$smarty.session.user.no}>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-2 text-right"><label>班级</label></div>
                            <div class="col-md-10"><{$smarty.session.user.class}>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-2 text-right"><label>姓名</label></div>
                            <div class="col-md-10"><{$smarty.session.user.name }>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-2 text-right"><label>性别</label></div>
                            <div class="col-md-10">
                                <{if $smarty.session.user.sex=='1'}>
                                男
                                <{else}>
                                女
                                <{/if}>
                            </div>
                        </div>

                        <div class="form-group clearfix">
                            <div class="col-md-2 text-right"><label>出生年月</label></div>
                            <div class="col-md-10"><{$smarty.session.user.birthday }>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-2 text-right"><label>籍贯</label></div>
                            <div class="col-md-10"><{$smarty.session.user.birthplace }>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-2 text-right"><label>民族</label></div>
                            <div class="col-md-10"><{$smarty.session.user.nation }>
                            </div>
                        </div>
                        <div class="form-group clearfix">
                            <div class="col-md-2 text-right"><label>身份证号</label></div>
                            <div class="col-md-10"><{$smarty.session.user.idcard }>
                            </div>
                        </div>
                        <div class="form-group clearfix hidden">
                            <div style="margin-left:-10px;"><label class="control-label col-md-2">性别</label></div>

                            <div class="col-md-6">
                                <div class="radio-inline">
                                    <label>
                                        <input type="radio" name="sex" value="1" <{if
                                        $smarty.session.user.sex=='1'}>checked<{/if}>>
                                        男
                                    </label>
                                </div>
                                <div class="radio-inline">
                                    <label>
                                        <input type="radio" name="sex" value="2" <{if
                                        $smarty.session.user.sex=='2'}>checked<{/if}>>
                                        女
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4 f12">

                            </div>
                        </div>

                        <div class="form-group clearfix hidden">
                            <div style="margin-left:-10px;"><label class="control-label col-md-2">出生年月</label></div>
                            <div class="col-md-6">
                                <input class="form-control input-lg" id="birthday" name="birthday" class="birthday"
                                       style="background:#fff;" size="30" type="text"
                                       value="<{$smarty.session.user.birthday}>" onblur="checkAge()"
                                       errormsg="1-100的整数">
                                <span id="tishi2" class="Validform_checktip">1-100的整数</span>

                            </div>
                            <div class="col-md-4 f12"></div>
                        </div>

                        <div class="form-group hidden">
                            <div class="col-md-6  col-md-offset-2">
                                <button id="sub2" class="btn btn-primary btn-lg">保存</button>
                            </div>
                        </div>
                    </form>
                </div>


                <div id="setpassword" style="display:none;">
                    <div class="col-md-7">

                        <div class="tt">
                            <h3>密码设置</h3>
                        </div>
                        <hr>
                        <form id="password-from" class="mt30 form-horizontal" autocomplete="off"
                              action="__APP__/Users/updatepassword" method="POST" onsubmit="return checkPass();">
                            <div class="form-group">
                                <label class="control-label col-md-2">原密码</label>

                                <div class="col-md-6">
                                    <input class="form-control col-md-3 input-lg" id="pass" onblur="checkPass()"
                                           name="password" size="30" type="password" placeholder="原密码" datatype="*6-16"
                                           nullmsg="请填写密码" errormsg="密码范围在6~16位之间" plugin="passwordStrength">
                                    <span id="tishi6" class="Validform_checktip"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">新密码</label>

                                <div class="col-md-6">
                                    <input class="form-control col-md-3 input-lg" id="new_pass" onblur="checkNewpass()"
                                           name="new_password" size="30" type="password" placeholder="新密码"
                                           datatype="*6-16" nullmsg="请填写新密码" errormsg="密码范围在6~16位之间"
                                           plugin="passwordStrength">
                                    <span id="tishi7" class="Validform_checktip">6-16个字符</span>
                                    <div class="passwordStrength" style="display:none;"><b>密码强度：</b>
                                        <span>弱</span><span>中</span><span class="last">强</span></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">重复新密码</label>
                                <div class="col-md-6">
                                    <input class="form-control input-lg col-md-3" id="re_new_pass"
                                           onblur="checkreNewpass()" name="re_new_password" size="30" type="password"
                                           placeholder="重复新密码" datatype="*6-16" recheck="new_password"
                                           nullmsg="请再输入一次密码" errormsg="两次输入的密码不一致" plugin="passwordStrength">
                                    <span id="tishi8" class="Validform_checktip"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-6  col-md-offset-2">
                                    <input type="submit" id="sub" value="保存" class="btn btn-primary btn-lg">
                                </div>
                            </div>
                        </form>
                        <div class="col-md-4 col-sm-offset-1"></div>
                    </div>
                </div>


            </div>

        </div>
    </div>

</div>

<!--

<script type="text/javascript">
    //表单验证函数
    function doCheck() {
        return checkName() && checkAge();
    }

    //验证姓名方法
    function checkName() {
        var name = document.myform.name.value;
        if (name.length == 0 || name.trim() == '') {
            //alert("姓名信息错误！");
            //document.myform.name.style.background="red';
            $("#name").css("background", "#e76e66");
            $("#tishi1").text("姓名不能为空！");
            $("#tishi1").css("color", "#e76e66");
            $("#sub2").attr("disabled", '1');
            return false;
        } else {
            $("#name").css("background", "#fff");
            $("#tishi1").text("正确！");
            $("#tishi1").css("color", "#999");
            $("#sub2").attr("disabled", null);
            return true;
        }
        return true;
    }

    //验证年龄方法
    function checkAge() {
        var age = document.myform.age.value;
        if (age.match(/^[1-9][0-9]*$/) == null || age > 99) {
            $("#age").css("background", "#e76e66");
            $("#tishi2").text("年龄输入错误！");
            $("#tishi2").css("color", "#e76e66");
            $("#sub2").attr("disabled", '1');
            return false;
        } else {
            $("#age").css("background", "#fff");
            $("#tishi2").text("年龄输入正确！");
            $("#tishi2").css("color", "#999");
            $("#sub2").attr("disabled", null);
            return true;
        }
        return true;
    }
</script>

-->

<script type="text/javascript">
    //密码表单验证函数
    function checkPass() {
        return checkOldpass() && checkreNewpass() && checkNewpass();
    }

    //验证姓名方法
    function checkOldpass() {
        var pass = $("#pass").val();
        //alert(pass);
        $.ajax({
            data: {'pass': pass},
            dataType: 'text',
            url: '__APP__/Users/editcheckpass',
            type: 'post',
            success: function (res) {
                if (res == 'ok') {
                    $("#pass").css("background", "#fff");
                    $("#tishi6").text("密码正确！");
                    $("#tishi6").css("color", "#999");
                    $("#sub").attr("disabled", null);
                    return 1;
                } else {
                    $("#pass").css("background", "#e76e66");
                    $("#tishi6").text("原密码输入错误！");
                    $("#tishi6").css("color", "#e76e66");
                    $("#sub").attr("disabled", "1");
                    return false;
                }
            },
        });

        if (pass.length == 0 || pass.trim() == '') {

            $("#pass").css("background", "#e76e66");
            $("#tishi6").text("原密码输入错误！");
            $("#tishi6").css("color", "#e76e66");
            $("#sub").attr("disabled", "1");
            return false;
        }
        return true;
    }

    //验证新密码方法
    function checkNewpass() {
        var newpass = $("#new_pass").val();

        if (newpass.length == 0 || newpass.trim() == '') {

            $("#new_pass").css("background", "#e76e66");
            $("#tishi7").text("新密码不能为空！");
            $("#tishi7").css("color", "#e76e66");
            $("#sub").attr("disabled", "1");
            return false;
        }
        if (newpass.match(/[a-zA-Z0-9]{6,16}$/) == null) {
            $("#new_pass").css("background", "#e76e66");
            $("#tishi7").text("新密码为6-16位！");
            $("#tishi7").css("color", "#e76e66");
            $("#sub").attr("disabled", "1");
            return false;
        } else {
            $("#new_pass").css("background", "#fff");
            $("#tishi7").text("新密码格式正确！");
            $("#tishi7").css("color", "#999");
            $("#sub").attr("disabled", null);
            return true;
        }

        return true;
    }
    function checkreNewpass() {
        var newpass = $("#new_pass").val();
        var renewpass = $("#re_new_pass").val();
        if (newpass.length == 0 || newpass.trim() == '') {

            $("#new_pass").css("background", "#e76e66");
            $("#tishi7").text("新密码不能为空！");
            $("#tishi7").css("color", "#e76e66");
            $("#sub").attr("disabled", "1");
        }
        if (newpass.match(/[a-zA-Z0-9]{6,16}$/) == null) {
            $("#new_pass").css("background", "#e76e66");
            $("#tishi7").text("新密码为6-16位！");
            $("#tishi7").css("color", "#e76e66");
            $("#sub").attr("disabled", "1");
        } else {
            $("#new_pass").css("background", "#fff");
            $("#tishi7").text("新密码格式正确！");
            $("#tishi7").css("color", "#999");


            if (newpass == renewpass && renewpass.length != 0) {
                $("#re_new_pass").css("background", "#fff");
                $("#tishi8").text("重复密码正确！");
                $("#tishi8").css("color", "#999");
                $("#sub").attr("disabled", null);

                return true;

            } else {
                $("#re_new_pass").css("background", "#e76e66");
                $("#tishi8").text("重复密码错误！");
                $("#tishi8").css("color", "#999");
                $("#sub").attr("disabled", "1");

                return false;
            }

        }

        return true;
    }


</script>


<{include file="../Public/footer.html"}>
		
		